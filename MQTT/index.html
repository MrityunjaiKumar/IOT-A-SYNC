
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../_media/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.0.1">
    
    
      
        <title>MQTT - IOT-A-SYNC</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.38780c08.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f72e892.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Barlow:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Barlow",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="blue" data-md-color-accent="indigo">
      
        <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script>
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mqtt" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="IOT-A-SYNC" class="md-header-nav__button md-logo" aria-label="IOT-A-SYNC">
      
  <img src="../_media/LOGO_sincgrid.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            IOT-A-SYNC
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              MQTT
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="IOT-A-SYNC" class="md-nav__button md-logo" aria-label="IOT-A-SYNC">
      
  <img src="../_media/LOGO_sincgrid.svg" alt="logo">

    </a>
    IOT-A-SYNC
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      IDE
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="IDE" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        IDE
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../environment/" title="Setting up environment" class="md-nav__link">
      Setting up environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../environment/Arduino_Environment/" title="Arduino IDE" class="md-nav__link">
      Arduino IDE
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../environment/Paltform_IO_Environment/" title="Platform IO" class="md-nav__link">
      Platform IO
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Driver/" title="Driver" class="md-nav__link">
      Driver
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GIT/" title="GIT" class="md-nav__link">
      GIT
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../pinouts/" title="IOT-A-SYNC Pinout" class="md-nav__link">
      IOT-A-SYNC Pinout
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Hardware/" title="Schematic" class="md-nav__link">
      Schematic
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Arduino/" title="Arduino FrameWork" class="md-nav__link">
      Arduino FrameWork
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Template/" title="Platform IO template" class="md-nav__link">
      Platform IO template
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../FreeRtos/" title="FreeRtos basics" class="md-nav__link">
      FreeRtos basics
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
    
    <label class="md-nav__link" for="nav-10">
      MQTT
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="MQTT" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon"></span>
        MQTT
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        MQTT
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="MQTT" class="md-nav__link md-nav__link--active">
      MQTT
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-mqtt" class="md-nav__link">
    What is MQTT?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-mqtt-work" class="md-nav__link">
    How Does MQTT Work?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    Output
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#platformioini" class="md-nav__link">
    platformio.ini
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maincpp" class="md-nav__link">
    main.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commonh" class="md-nav__link">
    common.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt_credentialh" class="md-nav__link">
    mqtt_credential.h
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="websockets/" title="Websockets" class="md-nav__link">
      Websockets
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Network Discovery
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Network Discovery" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        <span class="md-nav__icon md-icon"></span>
        Network Discovery
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../mDNS/" title="mDNS" class="md-nav__link">
      mDNS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-12" type="checkbox" id="nav-12">
    
    <label class="md-nav__link" for="nav-12">
      Buetooth communication
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Buetooth communication" data-md-level="1">
      <label class="md-nav__title" for="nav-12">
        <span class="md-nav__icon md-icon"></span>
        Buetooth communication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Bluetooth/" title="Bluetooth Introduction" class="md-nav__link">
      Bluetooth Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Bluetooth/Classic/" title="Bluetooth Classic" class="md-nav__link">
      Bluetooth Classic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Bluetooth/BLE/" title="Bluetooth Low Energy" class="md-nav__link">
      Bluetooth Low Energy
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Blueooth/BLE-MESH.md" title="BLE-MESH" class="md-nav__link">
      BLE-MESH
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-13" type="checkbox" id="nav-13">
    
    <label class="md-nav__link" for="nav-13">
      Lora Commnication
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Lora Commnication" data-md-level="1">
      <label class="md-nav__title" for="nav-13">
        <span class="md-nav__icon md-icon"></span>
        Lora Commnication
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../LORA/" title="LORA" class="md-nav__link">
      LORA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../LORA/LORAWAN/" title="LORAWAN" class="md-nav__link">
      LORAWAN
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      Examples
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Examples" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        <span class="md-nav__icon md-icon"></span>
        Examples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14-1" type="checkbox" id="nav-14-1">
    
    <label class="md-nav__link" for="nav-14-1">
      OnBoard Peripherals
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="OnBoard Peripherals" data-md-level="2">
      <label class="md-nav__title" for="nav-14-1">
        <span class="md-nav__icon md-icon"></span>
        OnBoard Peripherals
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Examples/OnBoard_Peripheral/Blink_Led/" title="Blink Led" class="md-nav__link">
      Blink Led
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Examples/OnBoard_Peripheral/IR_Reciever/" title="IR Reciever" class="md-nav__link">
      IR Reciever
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Examples/WebServer_plotting_Graph_of_TempPresHumAlt/" title="Webserver for plotting realtime graph" class="md-nav__link">
      Webserver for plotting realtime graph
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-mqtt" class="md-nav__link">
    What is MQTT?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-does-mqtt-work" class="md-nav__link">
    How Does MQTT Work?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output" class="md-nav__link">
    Output
  </a>
  
    <nav class="md-nav" aria-label="Output">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#platformioini" class="md-nav__link">
    platformio.ini
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maincpp" class="md-nav__link">
    main.cpp
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#commonh" class="md-nav__link">
    common.h
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mqtt_credentialh" class="md-nav__link">
    mqtt_credential.h
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="mqtt">MQTT</h1>
<h2 id="what-is-mqtt">What is MQTT?</h2>
<p>MQTT, or MQ Telemetry Transport, has become a de facto standard in this world, as it’s easy to set up, and works well without a lot of computing overhead. “MQ” at one time stood for Message Queuing, but it has now apparently transcended its acronym status.</p>
<h2 id="how-does-mqtt-work">How Does MQTT Work?</h2>
<p>MQTT uses a publish-subscribe methodology, where clients send and receive messages to each other through a centralized broker, also sometimes called a server. Clients both publish and subscribe to information channels called topics, and any data that passes on via the broker is tagged with a topic label. Once clients are pointed to the broker’s IP address, there’s no more system configuration involved. Clients simply send messages to a topic (that may or may not exist elsewhere) by publishing topic-tagged data to it. Clients listen to topics by subscribing to them.</p>
<p>Note that each client knows nothing about the other clients on the network; the broker merely takes care of data distribution. This can be to one client, many clients, or none, if nothing else is actually subscribed. All a client needs to know is where to find the broker/server. If a client’s IP address changes, or there are other modifications in the underlying system, as long as each client knows where to find the server, things will still function properly.</p>
<p>There are many ready to go and opensource mqtt client is available eg. <a href="https://mqttfx.jensd.de/">mqtt fx</a>, <a href="https://chrome.google.com/webstore/detail/mqttlens/hemojaaeigabkbcookmlgmdigohjobjm">mqtt lens</a> etc.</p>
<p>We can use then for teeting and visualisation purposes.</p>
<h2 id="example">Example</h2>
<h2 id="output">Output</h2>
<p><img alt="" src="../_media/mqtt_demo_screen.png" /></p>
<h3 id="platformioini">platformio.ini</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="c1">;PlatformIO Project Configuration File</span>
<span class="c1">;</span>
<span class="c1">;   Build options: build flags, source filter</span>
<span class="c1">;   Upload options: custom upload port, speed and extra flags</span>
<span class="c1">;   Library options: dependencies, extra library storages</span>
<span class="c1">;   Advanced options: extra scripting</span>
<span class="c1">;</span>
<span class="c1">; Please visit documentation for the other options and examples</span>
<span class="c1">; https://docs.platformio.org/page/projectconf.html</span>

<span class="k">[env:esp32dev]</span>
<span class="na">platform</span> <span class="o">=</span> <span class="s">espressif32</span>
<span class="na">framework</span> <span class="o">=</span> <span class="s">arduino</span>
<span class="na">board</span> <span class="o">=</span> <span class="s">esp32dev</span>
<span class="na">board_build.f_cpu</span> <span class="o">=</span> <span class="s">160000000L</span>
<span class="na">board_build.f_flash</span> <span class="o">=</span> <span class="s">80000000L</span>
<span class="na">board_build.flash_mode</span> <span class="o">=</span> <span class="s">qio</span>
<span class="na">build_flags</span> <span class="o">=</span>
<span class="na">-DWEBSOCKET_DISABLED</span><span class="o">=</span><span class="s">true</span>

<span class="na">lib_deps</span> <span class="o">=</span><span class="s"></span>
<span class="s">  ArduinoJson@~5.13.4</span>
<span class="c1">;   LoRa,</span>
<span class="c1">;   https://github.com/adafruit/Adafruit-GFX-Library.git</span>
  <span class="c1">; https://github.com/MrityunjaiKumar/esp8266-oled-ssd1306.git</span>
  <span class="c1">; https://github.com/MrityunjaiKumar/HELTEC_OLED.git</span>
  <span class="c1">; https://github.com/ThingPulse/esp8266-oled-ssd1306.git</span>
  <span class="c1">; https://github.com/adafruit/RadioHead.git</span>
  <span class="c1">; https://github.com/JoaoLopesF/RemoteDebug.git</span>
  <span class="c1">; https://github.com/MrityunjaiKumar/Heltec_ESP32_Lora.git</span>
  <span class="na">https://github.com/knolleary/pubsubclient.git</span>
  <span class="na">https://github.com/adafruit/Adafruit_Sensor.git</span>
  <span class="na">https://github.com/adafruit/Adafruit_BME280_Library.git</span>

<span class="na">monitor_speed</span> <span class="o">=</span> <span class="s">115200</span>
<span class="na">monitor_port</span> <span class="o">=</span> <span class="s">${common.port}</span>
<span class="na">upload_speed</span> <span class="o">=</span> <span class="s">921600</span>

<span class="na">upload_port</span> <span class="o">=</span> <span class="s">${common.port}</span>
<span class="c1">; upload_port=192.168.0.247 </span>
<span class="k">[common]</span>
<span class="na">port</span><span class="o">=</span><span class="s">COM11</span>
</code></pre></div>
</td></tr></table>

<h3 id="maincpp">main.cpp</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;Arduino.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;common.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;WiFi.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;mqtt_credential.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Wire.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;WiFi.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;PubSubClient.h&gt;</span><span class="cp"></span>

<span class="cp">#define use_dummy_data FALSE</span>
<span class="c1">// Replace the next variables with your SSID/Password combination</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ssid</span> <span class="o">=</span> <span class="n">WIFI_SSID</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">password</span> <span class="o">=</span> <span class="n">WIFI_PASSWORD</span><span class="p">;</span>

<span class="c1">// Add your MQTT Broker IP address, example:</span>
<span class="c1">//const char* mqtt_server = &quot;192.168.1.144&quot;;</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mqtt_server</span> <span class="o">=</span> <span class="n">broker_address</span><span class="p">;</span>

<span class="n">WiFiClient</span> <span class="n">espClient</span><span class="p">;</span>
<span class="n">PubSubClient</span> <span class="nf">client</span><span class="p">(</span><span class="n">espClient</span><span class="p">);</span>
<span class="kt">long</span> <span class="n">lastMsg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">msg</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
<span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup_wifi</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="c1">// We start by connecting to a WiFi network</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Connecting to &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ssid</span><span class="p">);</span>

  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;WiFi connected&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;IP address: &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">setup_wifi</span><span class="p">();</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setServer</span><span class="p">(</span><span class="n">mqtt_server</span><span class="p">,</span> <span class="n">broker_port</span><span class="p">);</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setCallback</span><span class="p">(</span><span class="n">callback</span><span class="p">);</span>
  <span class="c1">// #if !(use_dummy_data)</span>
  <span class="c1">// bme_setup();</span>
  <span class="c1">// #endif</span>
    <span class="n">randomSeed</span><span class="p">(</span><span class="n">analogRead</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">callback</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">topic</span><span class="p">,</span> <span class="n">byte</span> <span class="o">*</span><span class="n">message</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Message arrived on topic: &quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;. Message: &quot;</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">messageTemp</span><span class="p">;</span>

  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="n">message</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="n">messageTemp</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">message</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">reconnect</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Loop until we&#39;re reconnected</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Attempting MQTT connection...&quot;</span><span class="p">);</span>
    <span class="c1">// Attempt to connect</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;demo&quot;</span><span class="p">,</span> <span class="n">mqtt_client_username</span><span class="p">,</span> <span class="n">mqtt_client_password</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;connected&quot;</span><span class="p">);</span>
      <span class="c1">// Subscribe</span>
      <span class="n">client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">&quot;Tank_node_sub&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;failed, rc=&quot;</span><span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">state</span><span class="p">());</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; try again in 5 seconds&quot;</span><span class="p">);</span>
      <span class="c1">// Wait 5 seconds before retrying</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span>
  <span class="p">{</span>
    <span class="n">reconnect</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">client</span><span class="p">.</span><span class="n">loop</span><span class="p">();</span>

  <span class="kt">long</span> <span class="n">now</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">now</span> <span class="o">-</span> <span class="n">lastMsg</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">)</span>
  <span class="p">{</span>

    <span class="n">lastMsg</span> <span class="o">=</span> <span class="n">now</span><span class="p">;</span>
    <span class="c1">// #if !(use_dummy_data)</span>
    <span class="c1">// client.publish(mqtt_publish_topic, get_BME_payload().c_str());</span>
    <span class="c1">// #else</span>
     <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">mqtt_publish_topic</span><span class="p">,</span> <span class="n">get_dummy_BME_payload</span><span class="p">().</span><span class="n">c_str</span><span class="p">());</span>
    <span class="c1">// #endif</span>
    <span class="c1">// Serial.println(get_BME_payload());</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<h3 id="commonh">common.h</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>#ifndef _COMMOM_H
#define _COMMOM_H
#include &lt;Arduino.h&gt;
void callback(char *topic, byte *message, unsigned int length);
void reconnect();
void setup_wifi();
void bme_setup();
String get_BME_payload();
String get_dummy_BME_payload();
#endif //_COMMOM_H
</code></pre></div>
</td></tr></table>

<h3 id="mqtt_credentialh">mqtt_credential.h</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>#ifndef _MQTT_CREDENTIALS_H
#define _MQTT_CREDENTIALS_H

#define WIFI_SSID &quot;sincgrid&quot;
#define WIFI_PASSWORD &quot;sincgrid.com&quot;

#define broker_address &quot;192.168.0.106&quot;
#define broker_port 1883
#define mqtt_client_username &quot;&quot;
#define mqtt_client_password &quot;&quot;
#define mqtt_subscribe_topic &quot;IOTASYNC/sub&quot;
#define mqtt_publish_topic &quot;IOTASYNC/demo&quot;

#endif //_MQTT_CREDENTIALS_H`
</code></pre></div>
</td></tr></table>

<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&quot;common.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ArduinoJson.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Adafruit_Sensor.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Adafruit_BME280.h&gt;</span><span class="cp"></span>
<span class="n">Adafruit_BME280</span> <span class="n">bme</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">humidity</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">altitude</span><span class="p">;</span>

<span class="cp">#define SEALEVELPRESSURE_HPA (1050)</span>

<span class="kt">void</span> <span class="nf">bme_setup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// put your setup code here, to run once:</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="n">bme</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mh">0x76</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">bme_loop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// put your main code here, to run repeatedly:</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="n">bme</span><span class="p">.</span><span class="n">readTemperature</span><span class="p">();</span>
    <span class="n">humidity</span> <span class="o">=</span> <span class="n">bme</span><span class="p">.</span><span class="n">readHumidity</span><span class="p">();</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="n">bme</span><span class="p">.</span><span class="n">readPressure</span><span class="p">()</span> <span class="o">/</span> <span class="mf">100.0F</span><span class="p">;</span>
    <span class="n">altitude</span> <span class="o">=</span> <span class="n">bme</span><span class="p">.</span><span class="n">readAltitude</span><span class="p">(</span><span class="n">SEALEVELPRESSURE_HPA</span><span class="p">);</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Temperature = &quot;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; *C&quot;</span><span class="p">);</span>

    <span class="c1">// Convert temperature to Fahrenheit</span>
    <span class="cm">/*Serial.print(&quot;Temperature = &quot;);</span>
<span class="cm">  Serial.print(1.8 * bme.readTemperature() + 32);</span>
<span class="cm">  Serial.println(&quot; *F&quot;);*/</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Pressure = &quot;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">pressure</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; hPa&quot;</span><span class="p">);</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Approx. Altitude = &quot;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">altitude</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; m&quot;</span><span class="p">);</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Humidity = &quot;</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">humidity</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot; %&quot;</span><span class="p">);</span>

    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">String</span> <span class="nf">get_BME_payload</span><span class="p">()</span>
<span class="p">{</span>

    <span class="n">String</span> <span class="n">message</span><span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

    <span class="n">temperature</span> <span class="o">=</span> <span class="n">bme</span><span class="p">.</span><span class="n">readTemperature</span><span class="p">();</span>
    <span class="n">humidity</span> <span class="o">=</span> <span class="n">bme</span><span class="p">.</span><span class="n">readHumidity</span><span class="p">();</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="n">bme</span><span class="p">.</span><span class="n">readPressure</span><span class="p">()</span> <span class="o">/</span> <span class="mf">100.0F</span><span class="p">;</span>
    <span class="n">altitude</span> <span class="o">=</span> <span class="n">bme</span><span class="p">.</span><span class="n">readAltitude</span><span class="p">(</span><span class="n">SEALEVELPRESSURE_HPA</span><span class="p">);</span>

    <span class="c1">//  Serial.print(&quot;Temperature = &quot;);</span>
    <span class="c1">//  Serial.print(temperature);</span>
    <span class="c1">//  Serial.println(&quot; *C&quot;);</span>

    <span class="c1">//  // Convert temperature to Fahrenheit</span>
    <span class="c1">//  /*Serial.print(&quot;Temperature = &quot;);</span>
    <span class="c1">//   Serial.print(1.8 * bme.readTemperature() + 32);</span>
    <span class="c1">//   Serial.println(&quot; *F&quot;);*/</span>

    <span class="c1">//  Serial.print(&quot;Pressure = &quot;);</span>
    <span class="c1">//  Serial.print(pressure);</span>
    <span class="c1">//  Serial.println(&quot; hPa&quot;);</span>

    <span class="c1">//  Serial.print(&quot;Approx. Altitude = &quot;);</span>
    <span class="c1">//  Serial.print(altitude);</span>
    <span class="c1">//  Serial.println(&quot; m&quot;);</span>

    <span class="c1">//  Serial.print(&quot;Humidity = &quot;);</span>
    <span class="c1">//  Serial.print(humidity);</span>
    <span class="c1">//  Serial.println(&quot; %&quot;);</span>

    <span class="c1">//  Serial.println();</span>

    <span class="c1">//Encoder function</span>
    <span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">200</span><span class="o">&gt;</span> <span class="n">jsonBuffer</span><span class="p">;</span>
    <span class="n">JsonObject</span> <span class="o">&amp;</span><span class="n">root</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
    <span class="n">root</span><span class="p">[</span><span class="s">&quot;dev_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="p">;</span>
    <span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">iotasync_data</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">createNestedObject</span><span class="p">(</span><span class="s">&quot;iotasync_data&quot;</span><span class="p">);</span>
    <span class="n">iotasync_data</span><span class="p">[</span><span class="s">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span>
    <span class="n">iotasync_data</span><span class="p">[</span><span class="s">&quot;alt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">altitude</span><span class="p">);</span>
    <span class="n">iotasync_data</span><span class="p">[</span><span class="s">&quot;humidity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">humidity</span><span class="p">);</span>
    <span class="n">iotasync_data</span><span class="p">[</span><span class="s">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">pressure</span><span class="p">);</span>



    <span class="kt">char</span> <span class="n">JSONmessageBuffer</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>

    <span class="n">root</span><span class="p">.</span><span class="n">printTo</span><span class="p">(</span><span class="n">JSONmessageBuffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">JSONmessageBuffer</span><span class="p">));</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="n">String</span><span class="p">(</span><span class="n">JSONmessageBuffer</span><span class="p">);</span>

    <span class="c1">// StaticJsonBuffer&lt;200&gt; jsonBuffer2;</span>
    <span class="c1">// JsonObject &amp;root_out = jsonBuffer2.createObject();</span>


    <span class="c1">// char JSONmessageBuffer2[200];</span>

    <span class="c1">// root_out.printTo(JSONmessageBuffer2, sizeof(JSONmessageBuffer2));</span>
    <span class="c1">// message_outer += String(JSONmessageBuffer2);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">String</span> <span class="nf">get_dummy_BME_payload</span><span class="p">(){</span>

    <span class="n">String</span> <span class="n">message</span><span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>

    <span class="n">temperature</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">17</span><span class="p">);</span>
    <span class="n">humidity</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span><span class="mi">47</span><span class="p">);</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">5300</span><span class="p">,</span><span class="mi">5500</span><span class="p">)</span> <span class="o">/</span> <span class="mf">100.0F</span><span class="p">;</span>
    <span class="n">altitude</span> <span class="o">=</span> <span class="n">random</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">);</span>

    <span class="c1">//Encoder function</span>
    <span class="n">StaticJsonBuffer</span><span class="o">&lt;</span><span class="mi">200</span><span class="o">&gt;</span> <span class="n">jsonBuffer</span><span class="p">;</span>
    <span class="n">JsonObject</span> <span class="o">&amp;</span><span class="n">root</span> <span class="o">=</span> <span class="n">jsonBuffer</span><span class="p">.</span><span class="n">createObject</span><span class="p">();</span>
    <span class="n">root</span><span class="p">[</span><span class="s">&quot;dev_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;demo&quot;</span><span class="p">;</span>
    <span class="n">JsonObject</span><span class="o">&amp;</span> <span class="n">iotasync_data</span> <span class="o">=</span> <span class="n">root</span><span class="p">.</span><span class="n">createNestedObject</span><span class="p">(</span><span class="s">&quot;iotasync_data&quot;</span><span class="p">);</span>
    <span class="n">iotasync_data</span><span class="p">[</span><span class="s">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span>
    <span class="n">iotasync_data</span><span class="p">[</span><span class="s">&quot;alt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">altitude</span><span class="p">);</span>
    <span class="n">iotasync_data</span><span class="p">[</span><span class="s">&quot;humidity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">humidity</span><span class="p">);</span>
    <span class="n">iotasync_data</span><span class="p">[</span><span class="s">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">pressure</span><span class="p">);</span>



    <span class="kt">char</span> <span class="n">JSONmessageBuffer</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>

    <span class="n">root</span><span class="p">.</span><span class="n">printTo</span><span class="p">(</span><span class="n">JSONmessageBuffer</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">JSONmessageBuffer</span><span class="p">));</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="n">String</span><span class="p">(</span><span class="n">JSONmessageBuffer</span><span class="p">);</span>

    <span class="c1">// StaticJsonBuffer&lt;200&gt; jsonBuffer2;</span>
    <span class="c1">// JsonObject &amp;root_out = jsonBuffer2.createObject();</span>


    <span class="c1">// char JSONmessageBuffer2[200];</span>

    <span class="c1">// root_out.printTo(JSONmessageBuffer2, sizeof(JSONmessageBuffer2));</span>
    <span class="c1">// message_outer += String(JSONmessageBuffer2);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">message</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Git repository link for codes :- <a href="https://github.com/MrityunjaiKumar/ESP32-IOTA-SYNC.git">Repo</a> </p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../FreeRtos/" title="FreeRtos basics" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                FreeRtos basics
              </div>
            </div>
          </a>
        
        
          <a href="websockets/" title="Websockets" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Websockets
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://store.sincgrid.com/" target="_blank" rel="noopener" title="store.sincgrid.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M423.3 440.7c0 25.3-20.3 45.6-45.6 45.6s-45.8-20.3-45.8-45.6 20.6-45.8 45.8-45.8c25.4 0 45.6 20.5 45.6 45.8zm-253.9-45.8c-25.3 0-45.6 20.6-45.6 45.8s20.3 45.6 45.6 45.6 45.8-20.3 45.8-45.6-20.5-45.8-45.8-45.8zm291.7-270C158.9 124.9 81.9 112.1 0 25.7c34.4 51.7 53.3 148.9 373.1 144.2 333.3-5 130 86.1 70.8 188.9 186.7-166.7 319.4-233.9 17.2-233.9z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://t.me/sincgrid" target="_blank" rel="noopener" title="t.me" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9l-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://store.sincgrid.com/index.php?route=product/product&product_id=53" target="_blank" rel="noopener" title="store.sincgrid.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.77e55a48.min.js"></script>
      <script src="../assets/javascripts/bundle.aa3f9871.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['tabs'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>